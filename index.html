<!DOCTYPE html>
<!-- This is based on DillingerLee's great template here:
https://github.com/Team-Code/KA_Offline -->
<html> 
 <head>
    <title>Processing.JS inside Webpages: Template</title> 
</head>
 <body>
    <p align="center"> 
	<!--This draws the Canvas on the webpage -->
      <canvas id="mycanvas"></canvas> 
    </p>
 </body>
 
 <!-- Run all the JavaScript stuff -->
 <!-- Include the processing.js library -->
 <!-- See https://khanacademy.zendesk.com/hc/en-us/articles/202260404-What-parts-of-ProcessingJS-does-Khan-Academy-support- for differences -->
 <script src="https://cdn.jsdelivr.net/processing.js/1.4.8/processing.min.js"></script> 
 
 <script>
    var sketchProc = function(processingInstance) {
     with (processingInstance) {
        size(400, 400); 
        frameRate(30);
        
        // ProgramCodeGoesHere
        var Treat = function(x,y)
{
    this.x = x;
    this.y = y;
};
Treat.prototype.draw = function()
{
    fill(255, 132, 0);
    ellipse(this.x, this.y, 5, 5);
};

var Marvin = function(config)
{
    this.x = config.x;
    this.y = config.y;
    this.size = config.size || 20;
    this.treats = config.treats || 0;
};
Marvin.prototype.draw = function()
{
    this.y = constrain(this.y, 0 + this.size, height - this.size*0.7); 
    
    stroke(3, 3, 3);//tail
    noFill();
    strokeWeight(0.13*this.size);//tail thickness
    arc(this.x-0.3*this.size,this.y-0.6*this.size,1.9*this.size,2.0*this.size,0,40);//tail
    
    strokeWeight(2);
    fill(4, 3, 3);
    triangle(this.x-0.25*this.size, this.y-0.7*this.size, this.x-0.25*this.size, this.y-1.0*this.size,         this.x, this.y-0.8*this.size);//ears
    triangle(this.x+0.25*this.size, this.y-0.7*this.size, this.x+0.25*this.size, this.y-1.0*this.size,         this.x, this.y-0.8*this.size); 
    ellipse(this.x,this.y+0.4*this.size,0.85*this.size,0.22*this.size);//feet
    ellipse(this.x, this.y, this.size, this.size*1.1); // body
    
    rect(this.x-0.25*this.size,this.y-0.2*this.size,0.2*this.size,0.8*this.size,0.35*this.size);//legs
    rect(this.x+0.05*this.size,this.y-0.2*this.size,0.2*this.size,0.8*this.size,0.35*this.size);
    
    ellipse(this.x, this.y-(0.6*this.size), 0.6*this.size, 0.5*this.size); // face
    
    fill(71, 67, 60);//eyes
    ellipse(this.x -(0.1*this.size), this.y-0.60*this.size,0.1*this.size,0.1*this.size);
    ellipse(this.x +0.1*this.size, this.y-0.60*this.size,0.1*this.size,0.1*this.size); 
};
Marvin.prototype.hop = function()
{
    this.y -= 5;  
};
Marvin.prototype.fall = function()
{
    this.y += 5;
};
Marvin.prototype.checkForTreat = function(treat)
{
    var betweenXs = false;
    var betweenYs = false;
    
    if (treat.x >= this.x-(this.size*0.5) && treat.x <= this.x + (this.size*0.5))
    {
        betweenXs = true;
        
    }
    if (treat.y >= this.y-(this.size*0.5) && treat.y <= this.y + (this.size*0.5))
    {
        betweenYs = true;
    }
    if(betweenXs && betweenYs)
    {
        treat.y-=400; 
        this.size+=1;
        this.treats++;
    }
    
};
 
var player = new Marvin({x:70,y:0,size:30});

var treats = [];
for (var i = 0; i < 40; i++)
{
    treats.push(new Treat(i * 40 + 300, random(20, 360)));
} 

var grassXs = [];
for (var i = 0; i < 25; i++)
{
    grassXs.push(i*20);
}

draw = function() {
    background(129, 145, 247);
    fill(150, 68, 68); 
    rect(-1,380,402,21);
    
    for (var i = 0; i < grassXs.length; i++)
    {
        image(getImage("cute/GrassBlock"), grassXs[i], 365, 20, 20);
        grassXs[i]--;
        if (grassXs[i] <= -20)
        {
            grassXs[i] = 400;  
        }
    }
    
    for (var i = 0; i < treats.length; i++)
    {
        treats[i].draw();
        treats[i].x--;  
        player.checkForTreat(treats[i]);
    }
    
    if (keyIsPressed && key.code === 32) {
        player.hop();
    } else {
        player.fall();
    }
    player.draw();
    text("treats:" + player.treats, 20,20);
    

};

    }};

    // Get the canvas that Processing-js will use
    var canvas = document.getElementById("mycanvas"); 
    // Pass the function sketchProc (defined in myCode.js) to Processing's constructor.
    var processingInstance = new Processing(canvas, sketchProc); 
 </script>

</html>
